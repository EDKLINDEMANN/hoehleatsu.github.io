---
layout: post
title: "The Olympic Medal Table Visualized Gapminder Style"
tags: [datascience, rstats, olympic games]
bibliography: ~/Literature/Bibtex/jabref.bib
comments: true
---



{% include license.html %}

## Abstract

Following Hans Rosling's Gapminder animation style we visualize the total number a country wins during each olympic summer games in relation to the country's [gross domestic product](https://en.wikipedia.org/wiki/Gross_domestic_product) (GDP) per capita. We illustrate how R's data munging capabilities provide a useful toolbox to make such an analysis happen.


# Introduction

Long Swedish winter nights are best spent watching [Hans Rosling](https://en.wikipedia.org/wiki/Hans_Rosling)'s inspiring [TED talks](https://www.youtube.com/watch?v=hVimVzgtD6w). Such visualizations help the statistician make points about temporal trends in an x-axis to y-axis relationship, which otherwise might drown in modelling details.
Recently, I stumbled over a (blog post)[https://rpubs.com/sjackman/gapminder-gganimate] on how to use the  `gganimate` R package to animate the Gapminder available from the `gapminder` package. In order to perform a similar *Rosling style* animation consider the following task: Today, the olympic summer games end in Rio de Janeiro. As usual this spawns a debate, if the nation's participation has been successful. For this purpose the [olympic medal table](https://en.wikipedia.org/wiki/Olympic_medal_table) is often taken as basis for comparison, e.g., to mock your [neighbouring country](http://politiken.dk/sport/ol/ECE3349634/danmark-og-sverige-kaemper-til-det-sidste---men-hvor-daelen-er-norge-henne/). Recent analyses have been interested in how to correct these tables for, e.g., population size or, more interesting, analyse the influence of GDP.

The aim of the present blog note is to visualize how countries perform in the medal table in relation to their GDP. From a technical viewpoint we experiment with using R to scrape the olympic medal tables from Wikipedia and animate the results Gapminder style. **Disclaimer**: We only show the potential of such an analysis and, hence, worry less about the scientific validity of the analysis.

# Data

We use the data of [Gapminder](https://www.gapminder.org/) in order to obtain country specific population and GDP data for each of the years in the period of 1960-2016. The olympic medal tables are 'harvested' from Wikipedia.

## Olympic medal tables

Olympic medal tables were extracted using the `rvest` package from the corresponding Wikipedia pages by using table-extracting-code described in the post by [Cory Nissen](http://blog.corynissen.com/2015/01/using-rvest-to-scrape-html-table.html). The Wikipedia tables contain the current state of the medal table and hence take changes in the medal distribution, e.g. deprivation due to doping, into account. For details see on such a table, see for example the [medal table of the 2012 summer games](https://en.wikipedia.org/wiki/2012_Summer_Olympics_medal_table) in London. In order to stay focuses we hide
the scraping functionality in the function `scrape_medaltab` - see the code on GitHub for more details.




```r
#Years which had olympic games
olympic_years <- seq(1960, 2016, by=4)

# Extra olympic medal table from all olympic years since 1960
medals <- bind_rows(lapply(olympic_years, scrape_medaltab))

# Show result
DT::datatable(medals)
```

![](http://staff.math.su.se/hoehle/blog/figure/source/2016-08-21-gapMedal/unnamed-chunk-2-1.png)

## Gapminder data

We obtain GDP per capita and population data from [Gapminder](https://www.gapminder.org/data/). Unfortunately, these need to be fetched and merged manually. A more convenient way would have been to take these directly from the package [`gapminder`](https://cran.r-project.org/web/packages/gapminder/index.html), but the population is here only available for the years with GDP data and not, as in the original source data, for all years. Furthermore, newer (GDP data)[https://www.gapminder.org/data/documentation/gd001/] are available. We hide the data munging and refer to GitHub code for further details.



For convenience, we also extract the corresponding continent each country belongs to. This can be done conveniently by comparing with the `gapminder` dataset (see code for details).



## Joining the two data sources

In principle all that is left to do is to join the two data sources using the names of the gapminder dataset and the nation names of the olympic medal tables. However, this would ignore the fact that there is a discrepancy between the national olympic committees sending the athletes and the countries for which we have GDP information.

A further challenge of the present country based analysis is how to incorporate the many political changes which happened during that period. As an example, East Germany participated as independent national olympic committee during 1968-1988, but the gapminder data only contain GDP data for Germany as a total. We therefore choose to aggregate the results of the two countries for the analysis. A further important change is the split of the former Soviet Union into several independent states. As a consequence, in 1992 a subset of the former Soviet republics participated as [Unified Team](https://en.wikipedia.org/wiki/Unified_Team_at_the_1992_Summer_Olympics). The GDP values have to be obtained from the Gapminder data by manual summing the individual Soviet republic GDP values. We skip further details of these many data munging details and simply refer to the GitHub code for details and a **transparent & reproducible** account of how some of the above problems were handled.




```r
medals_gm <- left_join(medals_mod, gapminder_manual, by=c("Nation","Year"))
```

# Results

First we analyse the [all-time summer olympic medal table](https://en.wikipedia.org/wiki/All-time_Olympic_Games_medal_table) for the period 1960-2016.


```r
medals_alltime <- medals_gm  %>% group_by(Nation)  %>% summarise(Total=sum(Total))  %>% arrange(desc(Total))
DT::datatable(medals_alltime)
```

![](http://staff.math.su.se/hoehle/blog/figure/source/2016-08-21-gapMedal/unnamed-chunk-7-1.png)

We now plot of the total number of medals awarded for each summer games in the period of 1960-2016.

```r
nTotal <- medals_gm %>% group_by(Year) %>% summarise(TotalOfGames=sum(Total))
ggplot(nTotal, aes(x=Year,y=TotalOfGames)) + geom_line() + ylab("Total number of medals per Summer Games")
```

![](http://staff.math.su.se/hoehle/blog/figure/source/2016-08-21-gapMedal/TOTALMEDALSPERGAME-1.png)

We observe a clear trend. Hence, in order to make between country comparisons over time based on the number of medals won, we normalize the numbers of medal won using the total number of medals awarded during the  games. We store this result in the column `Frac`.


```r
medals_gm <- medals_gm %>% left_join(nTotal, by="Year") %>% mutate(Frac = Total / TotalOfGames)
```

We now look at the country results for the summer games 2000-2016.

![](http://staff.math.su.se/hoehle/blog/figure/source/2016-08-21-gapMedal/FACET2000ANDBEYOND-1.png)

Note that for better visualization of the many countries with a small number of medals, an sqrt-transform of the y-axis is used.

Finally, we can use the `gganimate` package to visualize the dependence of the total number of medals won in the summer games 1960-2016 as a function of GDP per capita. See the [package documentation](https://github.com/dgrtwo/gganimate) for details.



![]({{ site.baseurl }}/figure/source/2016-08-21-gapMedal/olympicMedals-gapminder-style.gif )

As before a sqrt-transform of the y-axis is used for better visualization. One interesting observation we see from the animation is that the home-country of the Olympics always appears to do well in the following Olympics. Also note that the [1980](https://en.wikipedia.org/wiki/1980_Summer_Olympics_boycott) and [1984](https://en.wikipedia.org/wiki/1984_Summer_Olympics_boycott) were special due to boycotts. With respect to the top-5 nations it is worth noticing that China, due to protests against the participation of Taiwan, did not participate in the Olympics 1956-1980. Furthermore, up to 1988 the team denoted "Germany" actually consists of the combined number of medals of "East Germany" and "West Germany".

To see the medal tables in a different light, we instead visualize a quantity relative to the number of medals per population. To enable cross-year comparisons we therefore compute the following index for each country and olympic summer games:
$$
\frac{\text{Fraction of All Medals the Country got in that Year}}{\text{Population in the Country that Year}} \times 10^6.
$$
We shall call this index the fraction of all medals per million population. A similar animation as above, now with logarithmic y-axis, illustrates the dynamics. To provide evidence supported neighbour mocking, we highlight the position of the three Nordic countries (Denmark, Sweden and Norway).




![]({{ site.baseurl }}/figure/source/2016-08-21-gapMedal/olympicMedals-perpop-gapminder-style.gif )

Jamaica, Bahamas and Grenada appear to do reasonably well lately compared to their population size. However, more more important - did you noticed the position of Denmark at the 2016 games in Rio?
